import { PoolClient } from 'pg';
import { DATASET_UPTREND, DATASET_DOWNTREND, SINGLE_CANDLE_BULLISH } from './ohlc_generator';

interface Question {
  type: 'multiple_choice' | 'true_false' | 'visual';
  question_text: string;
  options: string[] | null;
  correct_answer: string;
  explanation: string;
  visual_config: object | null;
  order_num: number;
}

interface LessonData {
  order_num: number;
  title: string;
  content: string;
  visual_type: string | null;
  visual_config: object | null;
  common_mistakes: string[];
  key_takeaways: string[];
  estimated_minutes: number;
  questions: Question[];
}

export async function seedLevel0(client: PoolClient, levelId: number): Promise<void> {
  const lessons: LessonData[] = [
    {
      order_num: 1,
      title: 'What is Trading?',
      content: `Trading is the act of buying and selling financial instruments—stocks, currencies, futures, or crypto—to profit from price movements. Unlike long-term investing, trading captures shorter-term moves lasting seconds, hours, days, or weeks. Prices are determined by supply and demand: more buyers push price up; more sellers push it down. Markets exist on this constant tug-of-war. To succeed you need three components: a defined strategy for identifying setups, precise risk management rules, and the mental discipline to execute consistently. Without all three, even good analysis leads to poor results. Begin with one market and one timeframe, build your skills systematically, and paper-trade before risking real capital.`,
      visual_type: null,
      visual_config: null,
      common_mistakes: [
        'Starting without a defined strategy',
        'Ignoring risk management from day one',
        'Trading too many markets simultaneously',
        'Confusing short-term trading with long-term investing',
        'Skipping paper trading before going live',
      ],
      key_takeaways: [
        'Trading profits come from price movements, not dividends',
        'Price reflects the collective force of supply and demand',
        'Strategy + risk management + discipline = the trader\'s foundation',
        'Start with one market and one strategy',
        'Paper trade before risking real capital',
      ],
      estimated_minutes: 4,
      questions: [
        {
          type: 'multiple_choice',
          question_text: 'What primarily determines the price of a financial asset?',
          options: ['Central bank policy alone', 'Supply and demand between buyers and sellers', 'Company earnings reports only', 'News headlines'],
          correct_answer: 'Supply and demand between buyers and sellers',
          explanation: 'Prices are set by the collective force of buyers and sellers. More buyers = price rises; more sellers = price falls.',
          visual_config: null,
          order_num: 1,
        },
        {
          type: 'true_false',
          question_text: 'Trading and long-term investing require identical approaches and strategies.',
          options: null,
          correct_answer: 'false',
          explanation: 'Investing focuses on multi-year appreciation. Trading targets shorter-term price movements and requires different strategies and time management.',
          visual_config: null,
          order_num: 2,
        },
        {
          type: 'multiple_choice',
          question_text: 'Which three elements form the core trader\'s foundation?',
          options: ['Indicators, signals, and subscriptions', 'Strategy, risk management, and discipline', 'Platform, broker, and software', 'Speed, volume, and leverage'],
          correct_answer: 'Strategy, risk management, and discipline',
          explanation: 'All three must work together. Great strategy fails without risk management; both fail without the discipline to execute consistently.',
          visual_config: null,
          order_num: 3,
        },
        {
          type: 'true_false',
          question_text: 'A scalper typically holds positions for several weeks.',
          options: null,
          correct_answer: 'false',
          explanation: 'Scalpers operate on very short timeframes (minutes or hours), aiming for small, frequent gains.',
          visual_config: null,
          order_num: 4,
        },
        {
          type: 'multiple_choice',
          question_text: 'What is the recommended first step before risking real capital?',
          options: ['Read every trading book available', 'Open a live account immediately', 'Practice on a demo (paper) account', 'Buy a trading signal service'],
          correct_answer: 'Practice on a demo (paper) account',
          explanation: 'Paper trading lets you practice strategy and execution in real-market conditions without financial risk.',
          visual_config: null,
          order_num: 5,
        },
      ],
    },
    {
      order_num: 2,
      title: 'How Financial Markets Work',
      content: `Financial markets are organized electronic systems that match buyers and sellers. When you place an order it enters an order book: buy orders (bids) queue below the current price; sell orders (asks) queue above. A transaction executes when a buy and sell order match. Participants range from retail traders (like you) to institutional funds managing billions. Institutions drive most large directional moves; retail traders react. Market makers provide continuous liquidity by always quoting buy and sell prices. Markets alternate between two states: trending (one side dominates) and ranging (neither side has conviction). Understanding this ecosystem helps you read why prices move sharply or stall.`,
      visual_type: null,
      visual_config: null,
      common_mistakes: [
        'Believing retail orders drive major price moves',
        'Ignoring the role of institutional order flow',
        'Assuming markets are purely random',
        'Not understanding bid/ask structure',
        'Overlooking how liquidity affects trade fills',
      ],
      key_takeaways: [
        'Markets are electronic auction systems matching buyers and sellers',
        'Bid = below current price; ask = above current price',
        'Institutions drive larger directional moves',
        'Market makers provide continuous liquidity',
        'Markets alternate between trending and ranging phases',
      ],
      estimated_minutes: 4,
      questions: [
        {
          type: 'multiple_choice',
          question_text: 'Where do buy orders (bids) queue relative to the current market price?',
          options: ['Above current price', 'Below current price', 'At the exact current price', 'Randomly across all levels'],
          correct_answer: 'Below current price',
          explanation: 'Buyers want to pay less than current price, so their pending orders sit below the current level.',
          visual_config: null,
          order_num: 1,
        },
        {
          type: 'true_false',
          question_text: 'Retail traders are primarily responsible for the major directional moves in financial markets.',
          options: null,
          correct_answer: 'false',
          explanation: 'Institutional participants manage vastly larger capital. Their order flow is responsible for most significant directional price moves.',
          visual_config: null,
          order_num: 2,
        },
        {
          type: 'multiple_choice',
          question_text: 'A market maker\'s primary function is to:',
          options: ['Predict future price movements', 'Set central bank interest rates', 'Provide continuous liquidity by always quoting buy and sell prices', 'Regulate trading activity for retail traders'],
          correct_answer: 'Provide continuous liquidity by always quoting buy and sell prices',
          explanation: 'Market makers ensure you can always find a counterpart for your trade by standing ready to buy or sell at their posted prices.',
          visual_config: null,
          order_num: 3,
        },
        {
          type: 'true_false',
          question_text: 'Markets spend equal amounts of time in trending and ranging phases.',
          options: null,
          correct_answer: 'false',
          explanation: 'Markets actually spend more time ranging/consolidating than trending strongly in one direction.',
          visual_config: null,
          order_num: 4,
        },
        {
          type: 'multiple_choice',
          question_text: 'The "order book" is best described as:',
          options: ['A trader\'s personal journal', 'A queue of all pending buy and sell orders at specific price levels', 'A list of available brokers', 'A historical record of completed trades only'],
          correct_answer: 'A queue of all pending buy and sell orders at specific price levels',
          explanation: 'The order book shows all resting buy and sell orders. When they match, a transaction occurs at that price.',
          visual_config: null,
          order_num: 5,
        },
      ],
    },
    {
      order_num: 3,
      title: 'Understanding Candlestick Charts',
      content: `Candlestick charts originated in 18th-century Japan and remain the standard for visualizing price. Each candle represents one time period—one day on a daily chart, one hour on an hourly chart. Four data points define every candle: the open (when the period started), close (when it ended), high (highest price reached), and low (lowest price reached). The body between open and close shows direction: green means close > open (buyers won); red means close < open (sellers won). The thin wicks above and below the body show how far price explored before reversing. A long upper wick = sellers rejected higher prices. A long lower wick = buyers defended lower prices. Context matters more than any single candle.`,
      visual_type: 'candlestick',
      visual_config: {
        type: 'candlestick',
        data: SINGLE_CANDLE_BULLISH,
        caption: 'A bullish candle: close above open, with upper and lower wicks showing price rejection at both extremes.',
      },
      common_mistakes: [
        'Ignoring wicks as irrelevant noise',
        'Reading candles without considering surrounding context',
        'Assuming candle color alone predicts next direction',
        'Forgetting that timeframe changes candle significance',
        'Confusing body size with total candle range',
      ],
      key_takeaways: [
        'OHLC: Open, High, Low, Close — four data points per candle',
        'Green candle = buyers controlled that period',
        'Red candle = sellers controlled that period',
        'Long wicks indicate price rejection',
        'Context (surrounding candles + trend) outweighs any single candle',
      ],
      estimated_minutes: 4,
      questions: [
        {
          type: 'multiple_choice',
          question_text: 'What do the four letters OHLC stand for in candlestick data?',
          options: ['Order, Hold, Limit, Cancel', 'Open, High, Low, Close', 'Offer, Hedge, Leverage, Capital', 'Open, Hold, Liquidate, Close'],
          correct_answer: 'Open, High, Low, Close',
          explanation: 'OHLC is the standard set of price data encoded in every candlestick: where price opened, its high, its low, and where it closed.',
          visual_config: null,
          order_num: 1,
        },
        {
          type: 'true_false',
          question_text: 'A long upper wick on a candle suggests sellers rejected higher prices.',
          options: null,
          correct_answer: 'true',
          explanation: 'Price moved up (creating the wick) but sellers pushed it back down before the period closed — evidence of selling pressure at those higher levels.',
          visual_config: null,
          order_num: 2,
        },
        {
          type: 'visual',
          question_text: 'Looking at the candle shown: it opens at 100, reaches a high of 113, a low of 97, and closes at 106. What type of candle is this?',
          options: [
            'Bearish candle with a long upper wick',
            'Bullish candle with both upper and lower wicks',
            'Doji (open equals close)',
            'Marubozu (no wicks at all)',
          ],
          correct_answer: 'Bullish candle with both upper and lower wicks',
          explanation: 'Close (106) > Open (100) = bullish (green). The high (113) creates an upper wick; the low (97) creates a lower wick.',
          visual_config: {
            type: 'candlestick',
            data: SINGLE_CANDLE_BULLISH,
          },
          order_num: 3,
        },
        {
          type: 'multiple_choice',
          question_text: 'On a 4-hour chart, each candlestick represents:',
          options: ['One minute of trading', 'One hour of trading', 'Four hours of trading', 'One full trading day'],
          correct_answer: 'Four hours of trading',
          explanation: 'The timeframe of the chart determines how much time each candle covers. A 4-hour chart = one candle per 4 hours.',
          visual_config: null,
          order_num: 4,
        },
        {
          type: 'true_false',
          question_text: 'A green (bullish) candle guarantees the next candle will also close green.',
          options: null,
          correct_answer: 'false',
          explanation: 'A single candle only reveals who controlled that one period. Future direction depends on broader context, not the color of one candle.',
          visual_config: null,
          order_num: 5,
        },
      ],
    },
    {
      order_num: 4,
      title: 'Reading Trend Direction',
      content: `A trend is a sustained directional movement in price. An uptrend is defined by higher highs (HH) and higher lows (HL): each rally peak exceeds the last, and each pullback stays above the prior pullback. A downtrend is the mirror: lower lows (LL) and lower highs (LH). Price rarely moves in a straight line—it zigzags while making progress in one direction. Trading with the trend dramatically improves your probability because you align with the dominant force. To identify a trend, ask: "Is price making a series of HH+HL, or LL+LH?" If neither pattern is clear, price is likely ranging and trend-following strategies become unreliable.`,
      visual_type: 'candlestick',
      visual_config: {
        type: 'candlestick',
        data: DATASET_UPTREND,
        caption: 'An uptrend: each swing high exceeds the last, each pullback stops above the prior swing low.',
      },
      common_mistakes: [
        'Labeling every short-term move as a new trend',
        'Trading counter-trend without the required skill',
        'Ignoring higher-timeframe trend context',
        'Calling a trend change after just one failed swing',
        'Applying trend strategies inside a ranging market',
      ],
      key_takeaways: [
        'Uptrend = higher highs and higher lows (HH + HL)',
        'Downtrend = lower lows and lower highs (LL + LH)',
        'Trading with the trend improves win probability',
        'Always check the higher-timeframe trend context',
        'Unclear structure = range; switch strategies accordingly',
      ],
      estimated_minutes: 4,
      questions: [
        {
          type: 'multiple_choice',
          question_text: 'An uptrend is defined by which price structure?',
          options: ['Lower lows and lower highs', 'Higher highs and higher lows', 'Flat highs with rising lows only', 'Random price movement'],
          correct_answer: 'Higher highs and higher lows',
          explanation: 'In an uptrend, each rally peak (HH) exceeds the previous, and each pullback bottom (HL) stays above the prior pullback bottom.',
          visual_config: null,
          order_num: 1,
        },
        {
          type: 'true_false',
          question_text: 'In a strong uptrend, price moves up in a perfectly straight line.',
          options: null,
          correct_answer: 'false',
          explanation: 'Even strong trends include pullbacks (corrections). The key is that pullbacks stay above prior lows while the trend continues.',
          visual_config: null,
          order_num: 2,
        },
        {
          type: 'visual',
          question_text: 'Looking at the chart shown, what type of trend is visible?',
          options: ['Downtrend — lower lows and lower highs', 'Uptrend — higher highs and higher lows', 'Sideways range — no clear direction', 'Unclear — the data is insufficient'],
          correct_answer: 'Uptrend — higher highs and higher lows',
          explanation: 'The chart shows price making progressively higher peaks and progressively higher pullback lows — the textbook definition of an uptrend.',
          visual_config: {
            type: 'candlestick',
            data: DATASET_UPTREND,
          },
          order_num: 3,
        },
        {
          type: 'true_false',
          question_text: 'Counter-trend trading is easier and safer than trend-following for beginners.',
          options: null,
          correct_answer: 'false',
          explanation: 'Counter-trend trading fights the dominant market force and requires greater skill, faster reaction, and tighter management.',
          visual_config: null,
          order_num: 4,
        },
        {
          type: 'multiple_choice',
          question_text: 'If price is consistently making lower lows and lower highs, the market is in a:',
          options: ['Uptrend', 'Downtrend', 'Sideways range', 'Breakout phase'],
          correct_answer: 'Downtrend',
          explanation: 'Lower lows (LL) and lower highs (LH) define a downtrend — the mirror image of an uptrend.',
          visual_config: null,
          order_num: 5,
        },
      ],
    },
    {
      order_num: 5,
      title: 'Introduction to Timeframes',
      content: `Every chart is viewed through a timeframe lens: the M1 (1-minute) chart shows one candle per minute; the D1 (daily) chart shows one candle per day. Higher timeframes (H4, Daily, Weekly) capture larger moves and each candle carries more significance because more transactions built it. Lower timeframes (M5, M15, M30) show finer detail but generate more noise. Smart traders use multiple timeframes together: identify trend on a higher timeframe, find entry on a lower timeframe. This is called top-down analysis. The higher-timeframe trend always overrules a lower-timeframe signal. Match your timeframe to your lifestyle: scalpers use 1–5 minute charts; swing traders use 4-hour and daily charts.`,
      visual_type: null,
      visual_config: null,
      common_mistakes: [
        'Using only one timeframe for all analysis',
        'Over-trading on very low timeframes where noise dominates',
        'Ignoring the higher-timeframe directional bias',
        'Switching timeframes mid-trade to justify a position',
        'Expecting 1-minute signals to have daily-chart significance',
      ],
      key_takeaways: [
        'Higher timeframes carry more weight per candle',
        'Top-down analysis: trend on high TF, entry on low TF',
        'Higher-timeframe trend overrules lower-timeframe signals',
        'Match timeframe to trading style and daily schedule',
        'H4/D1 for swing traders; M1/M5 for scalpers',
      ],
      estimated_minutes: 4,
      questions: [
        {
          type: 'multiple_choice',
          question_text: 'Which chart timeframe shows exactly one candle per trading day?',
          options: ['H1 (1-hour)', 'H4 (4-hour)', 'D1 (Daily)', 'W1 (Weekly)'],
          correct_answer: 'D1 (Daily)',
          explanation: 'The D1 daily chart shows one candle for each full trading day, capturing the entire day\'s open, high, low, and close.',
          visual_config: null,
          order_num: 1,
        },
        {
          type: 'true_false',
          question_text: 'A signal on the 5-minute chart is generally more reliable than a signal on the daily chart.',
          options: null,
          correct_answer: 'false',
          explanation: 'Higher timeframe signals are built from more transactions and carry more weight. Daily signals are more significant than 5-minute signals.',
          visual_config: null,
          order_num: 2,
        },
        {
          type: 'multiple_choice',
          question_text: '"Top-down analysis" in trading means:',
          options: [
            'Analyzing price from the highest pip to the lowest',
            'Identifying the trend on a higher timeframe, then finding precise entry on a lower timeframe',
            'Using indicators placed at the top and bottom of the chart',
            'Only trading after major news events',
          ],
          correct_answer: 'Identifying the trend on a higher timeframe, then finding precise entry on a lower timeframe',
          explanation: 'Top-down analysis uses the higher TF for directional bias and the lower TF for precise, lower-risk entry.',
          visual_config: null,
          order_num: 3,
        },
        {
          type: 'true_false',
          question_text: 'Scalpers primarily use H4 and daily charts for their entries.',
          options: null,
          correct_answer: 'false',
          explanation: 'Scalpers use very short timeframes (M1–M5) to capture rapid small moves. H4/D1 are used by swing traders.',
          visual_config: null,
          order_num: 4,
        },
        {
          type: 'multiple_choice',
          question_text: 'If the daily chart shows a strong downtrend, a 15-minute buy signal is considered:',
          options: ['Lower risk due to surprise factor', 'Higher risk — trading against the dominant bias', 'Always invalid regardless of setup quality', 'The most profitable trade type'],
          correct_answer: 'Higher risk — trading against the dominant bias',
          explanation: 'Counter-trend trades on lower timeframes face resistance from the dominant higher-timeframe direction, reducing probability.',
          visual_config: null,
          order_num: 5,
        },
      ],
    },
    {
      order_num: 6,
      title: 'Bid, Ask, and the Spread',
      content: `Every price quote shows two numbers: bid and ask. The bid is the highest price buyers are willing to pay right now; the ask is the lowest price sellers will accept. You always buy at the ask and sell at the bid. The spread is the difference between them — it is your immediate cost of entry. If EUR/USD shows bid 1.0850 / ask 1.0852, the spread is 2 pips. Your trade begins 2 pips in the red. Brokers and market makers earn the spread as compensation for providing liquidity. Spreads widen during low-liquidity periods (weekends, major news releases) and tighten during peak trading hours. Always factor the spread into your risk calculation.`,
      visual_type: null,
      visual_config: null,
      common_mistakes: [
        'Ignoring the spread when calculating expected profit',
        'Trading illiquid instruments with very wide spreads',
        'Entering trades during news events when spreads spike sharply',
        'Confusing bid and ask when placing orders',
        'Not accounting for spread when setting stop loss distance',
      ],
      key_takeaways: [
        'Bid = highest current buy offer; ask = lowest current sell offer',
        'You buy at the ask and sell at the bid',
        'Spread = ask − bid = your immediate cost on entry',
        'Spreads widen during low-liquidity and news events',
        'Factor the spread into entry and stop loss calculations',
      ],
      estimated_minutes: 3,
      questions: [
        {
          type: 'multiple_choice',
          question_text: 'When you open a trade, you buy at the _____ price and sell at the _____ price:',
          options: ['Bid / Ask', 'Ask / Bid', 'Mid / Bid', 'Ask / Mid'],
          correct_answer: 'Ask / Bid',
          explanation: 'You buy at the ask (the seller\'s asking price) and sell at the bid (the buyer\'s offered price). The spread is the gap between them.',
          visual_config: null,
          order_num: 1,
        },
        {
          type: 'true_false',
          question_text: 'A wide spread benefits retail traders by giving them more room to profit.',
          options: null,
          correct_answer: 'false',
          explanation: 'A wide spread increases your cost of entry. You start further in the red and need a larger move to reach profitability.',
          visual_config: null,
          order_num: 2,
        },
        {
          type: 'multiple_choice',
          question_text: 'The spread in a currency pair most directly represents:',
          options: ['Your potential profit target', 'The immediate cost of entering the trade', 'The broker\'s commission only', 'The difference between candle open and close'],
          correct_answer: 'The immediate cost of entering the trade',
          explanation: 'The moment you enter, your trade is already down by the spread amount. It is the cost you pay to access the market.',
          visual_config: null,
          order_num: 3,
        },
        {
          type: 'true_false',
          question_text: 'Spreads remain constant and fixed regardless of market conditions.',
          options: null,
          correct_answer: 'false',
          explanation: 'Variable spreads widen during low liquidity and news events. Even fixed spreads reflect average conditions, not all conditions.',
          visual_config: null,
          order_num: 4,
        },
        {
          type: 'multiple_choice',
          question_text: 'When do spreads typically widen the most?',
          options: ['During the peak London–New York overlap session', 'During low-liquidity periods and major news releases', 'When markets are strongly trending', 'Early morning in the most liquid sessions'],
          correct_answer: 'During low-liquidity periods and major news releases',
          explanation: 'Lower liquidity means fewer participants willing to make markets, so market makers widen spreads to compensate for increased risk.',
          visual_config: null,
          order_num: 5,
        },
      ],
    },
    {
      order_num: 7,
      title: 'Market Orders vs Limit Orders',
      content: `A market order executes immediately at the current best available price — it guarantees execution but not the exact price. In fast markets you may experience slippage (a fill slightly worse than expected). A limit order executes only at your specified price or better. A buy limit is placed below current price (you want to buy cheaper); a sell limit above (you want to sell higher). Limit orders give price control but not execution certainty — if price never reaches your level, the order stays unfilled. A stop order triggers when price passes a threshold then executes as a market order; used for stop losses and breakout entries. Use market orders for fast breakouts; limit orders for precise retest entries.`,
      visual_type: null,
      visual_config: null,
      common_mistakes: [
        'Using market orders in thin, low-liquidity conditions causing large slippage',
        'Setting limit orders and forgetting to manage or cancel them',
        'Confusing stop orders with limit orders',
        'Placing stop losses too far from entry without structure justification',
        'Not accounting for slippage in profit and loss calculations',
      ],
      key_takeaways: [
        'Market order: immediate fill, no price guarantee',
        'Limit order: price control, no execution guarantee',
        'Stop order: triggers at a threshold, then fills as a market order',
        'Use limit orders for precise entries on pullbacks',
        'Account for potential slippage in fast-moving markets',
      ],
      estimated_minutes: 4,
      questions: [
        {
          type: 'multiple_choice',
          question_text: 'Which order type executes immediately at the current available price?',
          options: ['Limit order', 'Stop-limit order', 'Market order', 'Good-till-cancelled order'],
          correct_answer: 'Market order',
          explanation: 'A market order fills immediately at the best available price in the order book, guaranteeing execution but not a specific price.',
          visual_config: null,
          order_num: 1,
        },
        {
          type: 'true_false',
          question_text: 'A buy limit order is placed above the current market price.',
          options: null,
          correct_answer: 'false',
          explanation: 'A buy limit is placed below current price because you want to buy at a cheaper level when price pulls back.',
          visual_config: null,
          order_num: 2,
        },
        {
          type: 'multiple_choice',
          question_text: '"Slippage" in trading refers to:',
          options: ['A trading mistake or error', 'Getting a worse fill price than the price you intended', 'A type of limit order', 'The spread widening during news'],
          correct_answer: 'Getting a worse fill price than the price you intended',
          explanation: 'In fast-moving markets, by the time your market order reaches the book the best price may have moved, resulting in a worse fill.',
          visual_config: null,
          order_num: 3,
        },
        {
          type: 'multiple_choice',
          question_text: 'A stop-loss order is best described as:',
          options: ['A market order placed at the start of every trade', 'A limit order used to capture profit', 'A stop order that automatically closes a losing trade at a predefined level', 'A buy limit placed above current price'],
          correct_answer: 'A stop order that automatically closes a losing trade at a predefined level',
          explanation: 'A stop loss is a stop order set at the level where your trade idea is invalidated — it closes the position to limit your loss.',
          visual_config: null,
          order_num: 4,
        },
        {
          type: 'true_false',
          question_text: 'A limit order guarantees execution as long as price touches the specified level.',
          options: null,
          correct_answer: 'false',
          explanation: 'Price must trade at or better than your limit price. A brief wick touch may not guarantee a fill depending on available liquidity at that exact level.',
          visual_config: null,
          order_num: 5,
        },
      ],
    },
    {
      order_num: 8,
      title: 'Basic Risk Principles',
      content: `Risk management is the difference between traders who survive long-term and those who blow up. The core rule: never risk more than 1–2% of your trading account on any single trade. On a $10,000 account that means a maximum loss of $100–$200 per trade. This single rule prevents one bad day from destroying your account. Every trade must have a predefined stop loss — a price level where you admit the trade idea is wrong and exit. Never move a stop loss further away to avoid a loss; that transforms a small loss into a large one. Risk is calculated as: (distance from entry to stop) × (position size per unit). Size down until the dollar loss is within your 1–2% limit.`,
      visual_type: null,
      visual_config: null,
      common_mistakes: [
        'Trading without a predefined stop loss',
        'Moving the stop loss further away to avoid taking a loss',
        'Risking more than 2% of account per trade',
        'Using the same position size regardless of stop distance',
        'Not adjusting position size after account growth or drawdown',
      ],
      key_takeaways: [
        'Risk 1–2% of account balance per trade maximum',
        'Always define your stop loss before entering',
        'Never widen a stop loss to avoid a loss',
        'Position size = (account risk in $) ÷ (distance to stop × value per unit)',
        'Long-term survival and consistency beat chasing big wins',
      ],
      estimated_minutes: 5,
      questions: [
        {
          type: 'multiple_choice',
          question_text: 'A trader with a $5,000 account following the 2% risk rule should risk at most how much per trade?',
          options: ['$500', '$200', '$50', '$1,000'],
          correct_answer: '$100',
          explanation: '2% of $5,000 = $100. That is the maximum dollar risk per trade to stay within the rule.',
          visual_config: null,
          order_num: 1,
        },
        {
          type: 'true_false',
          question_text: 'Moving your stop loss further away to avoid taking a loss is a sound risk management practice.',
          options: null,
          correct_answer: 'false',
          explanation: 'Widening a stop converts a planned small loss into a larger unplanned one. Always honor your original stop placement.',
          visual_config: null,
          order_num: 2,
        },
        {
          type: 'multiple_choice',
          question_text: 'Position size should be determined by:',
          options: [
            'Market volatility alone',
            'How confident you feel about the setup',
            'Risk per trade in dollars divided by distance to stop loss',
            'The broker\'s default lot size recommendation',
          ],
          correct_answer: 'Risk per trade in dollars divided by distance to stop loss',
          explanation: 'This formula keeps your dollar risk constant regardless of stop distance. Tighter stop = larger size; wider stop = smaller size.',
          visual_config: null,
          order_num: 3,
        },
        {
          type: 'true_false',
          question_text: 'Traders who risk more per trade always generate more profit over the long term.',
          options: null,
          correct_answer: 'false',
          explanation: 'Higher risk per trade leads to faster account depletion during losing streaks. Consistent 1–2% risk compounds safely over time.',
          visual_config: null,
          order_num: 4,
        },
        {
          type: 'multiple_choice',
          question_text: 'The primary purpose of a stop loss is to:',
          options: ['Guarantee profit on every trade', 'Limit the loss on a single trade to a predefined amount', 'Prevent all losing trades from occurring', 'Set a minimum profit target'],
          correct_answer: 'Limit the loss on a single trade to a predefined amount',
          explanation: 'A stop loss defines the maximum you can lose on a trade. It removes the risk of a small loss growing into an account-destroying one.',
          visual_config: null,
          order_num: 5,
        },
      ],
    },
    {
      order_num: 9,
      title: 'Trading Psychology Fundamentals',
      content: `Trading is as much a mental game as a technical one. The two most destructive emotions are fear and greed. Fear causes premature exits — you close a winning trade early, terrified of giving back gains. Greed causes over-leveraging, skipping stop losses, or holding losing trades hoping they recover. The solution is a mechanical process: define your rules before entering a trade and follow them exactly, every time. Other pitfalls include revenge trading (impulsive trades after a loss to "win it back"), overconfidence after a winning streak, and analysis paralysis (too much information, can't pull the trigger). Journaling every trade — why you took it, how you managed it, how you felt — is the most powerful tool for identifying and correcting psychological patterns.`,
      visual_type: null,
      visual_config: null,
      common_mistakes: [
        'Moving stop losses on losing trades due to emotional discomfort',
        'Closing winning trades too early out of fear',
        'Revenge trading after a series of losses',
        'Overtrading during a losing streak to recover',
        'Not keeping a trade journal to track patterns',
      ],
      key_takeaways: [
        'Fear and greed are the trader\'s greatest enemies',
        'Define all rules before the trade to remove in-trade emotion',
        'Journaling accelerates psychological growth',
        'Revenge trading after losses destroys accounts',
        'Process consistency matters more than any single trade outcome',
      ],
      estimated_minutes: 5,
      questions: [
        {
          type: 'multiple_choice',
          question_text: '"Revenge trading" is best described as:',
          options: [
            'Trading with an experienced mentor after a loss',
            'Taking impulsive, oversized trades immediately after a loss to recover money',
            'Shorting a company you personally dislike',
            'Trading overnight to recoup intraday losses',
          ],
          correct_answer: 'Taking impulsive, oversized trades immediately after a loss to recover money',
          explanation: 'Revenge trading is driven by emotion rather than strategy and typically leads to larger losses on top of the original one.',
          visual_config: null,
          order_num: 1,
        },
        {
          type: 'true_false',
          question_text: 'Keeping a detailed trade journal helps identify emotional patterns and improve long-term consistency.',
          options: null,
          correct_answer: 'true',
          explanation: 'Journaling creates a feedback loop: you record your emotions, review the patterns, and systematically improve your decision-making.',
          visual_config: null,
          order_num: 2,
        },
        {
          type: 'multiple_choice',
          question_text: 'The best time to define your trading rules and criteria is:',
          options: [
            'During the trade, when you can see how price is behaving',
            'After each trade using hindsight',
            'Before entering the trade, in a calm pre-market session',
            'When the market opens and volatility is highest',
          ],
          correct_answer: 'Before entering the trade, in a calm pre-market session',
          explanation: 'Rules made before the trade are objective. Rules made during the trade are emotional and almost always lead to poor decisions.',
          visual_config: null,
          order_num: 3,
        },
        {
          type: 'true_false',
          question_text: 'Overconfidence following a winning streak is harmless and improves trading performance.',
          options: null,
          correct_answer: 'false',
          explanation: 'Overconfidence leads to over-sizing, skipping rules, and ignoring risk management — setting up for a large loss that wipes out the winning streak.',
          visual_config: null,
          order_num: 4,
        },
        {
          type: 'multiple_choice',
          question_text: 'Which emotion most commonly causes traders to close winning trades prematurely?',
          options: ['Greed', 'Boredom', 'Fear', 'Overconfidence'],
          correct_answer: 'Fear',
          explanation: 'Fear of losing accumulated paper profits causes traders to exit early, cutting their winners shorter than planned and harming their long-term R:R.',
          visual_config: null,
          order_num: 5,
        },
      ],
    },
    {
      order_num: 10,
      title: 'Setting Up Your Trading Workspace',
      content: `Your trading environment directly affects focus and consistency. At minimum you need: a reliable charting platform, a brokerage account (or demo account for practice), and a system for logging trades. Choose a broker regulated in your jurisdiction with competitive spreads for your instrument. Set up your charts cleanly: remove cluttered default indicators; keep only the tools your strategy actually uses. Maintain a consistent workspace — same watchlist, same timeframes, same layout every session. Build two daily routines: a pre-session review (10 minutes analyzing key levels and overall bias) and a post-session review (logging trades and observations in your journal). Consistency in your environment reinforces consistency in your decisions.`,
      visual_type: null,
      visual_config: null,
      common_mistakes: [
        'Cluttering charts with too many conflicting indicators',
        'Switching platforms frequently during the learning phase',
        'Not building a structured pre-session preparation routine',
        'Skipping post-session review and trade logging',
        'Using demo settings (e.g., unrealistic sizing) that don\'t reflect real trading conditions',
      ],
      key_takeaways: [
        'Clean, uncluttered charts support clearer thinking',
        'Pre-session review builds awareness of key levels and bias',
        'Post-session journaling drives long-term improvement',
        'Consistent workspace habits reinforce consistent trading habits',
        'Use a demo account to practice before committing real capital',
      ],
      estimated_minutes: 4,
      questions: [
        {
          type: 'multiple_choice',
          question_text: 'The purpose of a pre-session review is to:',
          options: [
            'Place as many trades as possible before the market opens',
            'Identify key levels and directional bias before the trading session begins',
            'Copy setups shared by other traders online',
            'Check news and social media for trade ideas',
          ],
          correct_answer: 'Identify key levels and directional bias before the trading session begins',
          explanation: 'Pre-session preparation means you enter the session knowing where the important levels are, reducing reactive decision-making.',
          visual_config: null,
          order_num: 1,
        },
        {
          type: 'true_false',
          question_text: 'Adding more indicators to your chart always improves the accuracy of your trading decisions.',
          options: null,
          correct_answer: 'false',
          explanation: 'More indicators create conflicting signals and visual noise. The best charts are clean, showing only what your strategy requires.',
          visual_config: null,
          order_num: 2,
        },
        {
          type: 'multiple_choice',
          question_text: 'What is the minimum setup a trader needs to get started?',
          options: [
            'Five monitors and a professional Bloomberg terminal',
            'A charting platform, brokerage/demo account, and trade journal',
            'A paid signal service and copy-trading subscription',
            'Advanced programming skills for algorithmic strategies',
          ],
          correct_answer: 'A charting platform, brokerage/demo account, and trade journal',
          explanation: 'These three tools cover chart analysis, trade execution, and performance review — the complete feedback loop for improving.',
          visual_config: null,
          order_num: 3,
        },
        {
          type: 'true_false',
          question_text: 'A post-session review is an optional activity with little long-term benefit.',
          options: null,
          correct_answer: 'false',
          explanation: 'Post-session review is where learning compounds. Reviewing what worked, what didn\'t, and why is the core of deliberate improvement.',
          visual_config: null,
          order_num: 4,
        },
        {
          type: 'multiple_choice',
          question_text: 'When choosing a broker, which factor is most important for a retail trader?',
          options: [
            'Whether they offer the highest possible leverage',
            'Regulatory status in your jurisdiction and competitive spreads',
            'The size of their social media following',
            'Whether they provide free trading signals',
          ],
          correct_answer: 'Regulatory status in your jurisdiction and competitive spreads',
          explanation: 'A regulated broker protects your capital. Competitive spreads directly affect your profitability on every trade.',
          visual_config: null,
          order_num: 5,
        },
      ],
    },
  ];

  for (const lesson of lessons) {
    const { questions, ...lessonData } = lesson;
    const lessonResult = await client.query(
      `INSERT INTO lessons (level_id, order_num, title, content, visual_type, visual_config, common_mistakes, key_takeaways, estimated_minutes)
       VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9) RETURNING id`,
      [
        levelId,
        lessonData.order_num,
        lessonData.title,
        lessonData.content,
        lessonData.visual_type,
        lessonData.visual_config ? JSON.stringify(lessonData.visual_config) : null,
        JSON.stringify(lessonData.common_mistakes),
        JSON.stringify(lessonData.key_takeaways),
        lessonData.estimated_minutes,
      ]
    );
    const lessonId: number = lessonResult.rows[0].id;

    for (const q of questions) {
      await client.query(
        `INSERT INTO questions (lesson_id, type, question_text, options, correct_answer, explanation, visual_config, order_num)
         VALUES ($1,$2,$3,$4,$5,$6,$7,$8)`,
        [
          lessonId,
          q.type,
          q.question_text,
          q.options ? JSON.stringify(q.options) : null,
          q.correct_answer,
          q.explanation,
          q.visual_config ? JSON.stringify(q.visual_config) : null,
          q.order_num,
        ]
      );
    }
  }

  console.log(`  ✓ Level 0: ${lessons.length} lessons inserted`);
}
